name: Test Phase

on: [ push, pull_request ]

jobs:

  test:
    runs-on: self-hosted
    steps:
    - uses: actions/checkout@v2
    - name: Install Dependencies
      run: |
        pip3 install --upgrade pip
        pip3 install -r requirements.txt
        
    - uses: actions/checkout@v2
    - name: Run Tests
      run: |
        cd djangoproject
        python3 manage.py behave

    - name: Discord Notification
      env:
        DISCORD_BOT_TOKEN: ${{ secrets.DISCORD_BOT_TOKEN }}
      run: python3 discord_bot.py -t ${{ steps.date.outputs.date }} -b ${{github.ref_name}} -s ${{ github.event.workflow_run.conclusion == 'success' }} -p ${{ github.job }}
